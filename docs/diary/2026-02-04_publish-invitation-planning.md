# 청첩장 발행 기능 기획

**날짜**: 2026-02-04
**작업자**: JYK
**상태**: 기획 완료, 구현 대기

---

## 작업한 내용

### 발견한 문제
1. **새 탭에서 미리보기 안됨**: TopBar, PreviewPanel에 "새 탭에서 보기" 버튼이 `/inv/${id}`를 호출하지만 해당 페이지가 없음
2. **발행 기능 없음**: 편집만 가능하고 실제 공개하는 기능이 없음

### 기획한 내용
1. **청첩장 공개 조회 페이지** (`/app/inv/[id]/page.tsx`)
   - 로그인 불필요 공개 페이지
   - status가 PUBLISHED인 경우만 접근
   - DRAFT면 "준비 중" 메시지
   - 템플릿 렌더링만 (편집 불가)

2. **발행하기 기능**
   - TopBar에 "발행하기" 버튼 추가
   - 필수 필드 검증:
     - 신랑/신부 이름
     - 예식 날짜
     - 예식장 이름/주소
   - 검증 실패 시 누락 항목 알림
   - 성공 시 DRAFT → PUBLISHED + URL 복사

### 작업 생성
- Task #3: 청첩장 공개 조회 페이지 구현
- Task #4: 발행하기 기능 및 검증 로직 구현

---

## 왜 했는지 (맥락)

현재 편집기는 완성됐지만 실제로 청첩장을 "공개"하는 플로우가 없었음:
- 편집 → 저장 → **?**
- 미리보기 버튼은 있지만 페이지가 없어서 404
- DRAFT/PUBLISHED status는 스키마에 정의돼있지만 전환 UI가 없음

사용자 관점에서 보면:
1. 청첩장 만들기 (편집)
2. 미리보기 확인
3. **발행하기** ← 이게 없음
4. 링크 공유

결혼식 초대장은 "만들고 끝"이 아니라 "발행해서 공유"가 핵심이므로 이 기능이 MVP에 필수.

---

## 논의/아이디어/고민

### 1. 발행 취소 필요한가?
**질문**: PUBLISHED → DRAFT로 되돌리는 "비공개로 전환" 기능 필요?

**시나리오**:
- 잘못 발행했을 때
- 정보 수정 후 다시 발행
- 결혼식 끝난 후 링크 비활성화

**판단 보류**: 사용자 피드백 기다림

### 2. 필수 검증 항목 범위
**제안한 필수 항목**:
- 신랑/신부 이름
- 예식 날짜
- 예식장 이름/주소

**추가 고려**:
- 인사말? → 선택 (템플릿 기본값 있음)
- 계좌? → 선택 (안 받을 수도 있음)
- 갤러리? → 선택 (사진 없을 수도)

**결정**: 최소한으로 유지, 사용자가 원하면 비워둘 수 있게

### 3. 발행 후 편집 가능?
**고민**: PUBLISHED 상태에서도 편집 가능해야 하나?

**일반적 플로우**:
- 발행 전: 자유롭게 편집
- 발행 후: 수정 가능하지만 즉시 반영 (버전 관리 없음)

**판단**: 일단 편집 가능하게, 나중에 "수정 이력" 기능 추가 고려

### 4. URL 구조
**현재**: `/inv/[id]`
- 장점: 짧고 단순
- 단점: id가 예측 가능하면 DRAFT도 접근 가능

**대안**: `/inv/[nanoid]` (짧은 랜덤 ID)
- 장점: 보안
- 단점: DB에 별도 필드 필요

**판단**: 일단 id 사용, status 체크로 DRAFT 접근 차단. 나중에 nanoid 추가 고려.

---

## 결정된 내용

### 구현 스펙 확정
1. **공개 페이지**:
   - `/app/inv/[id]/page.tsx`
   - status === 'PUBLISHED'만 접근
   - 로그인 불필요
   - 모바일 우선 반응형

2. **발행 버튼**:
   - TopBar에 추가 (공유 버튼 옆)
   - 필수 검증: 이름, 날짜, 장소
   - 실패 시: 누락 탭으로 이동 (Sidebar 활용)
   - 성공 시: 토스트 + URL 복사

3. **API**:
   - 기존 `PATCH /api/invitations/[id]` 사용
   - body: `{ status: 'PUBLISHED' }`

### 보류된 사항
- 발행 취소 (비공개 전환) 기능 → 사용자 피드백 후 결정
- nanoid URL → Phase 2 보안 강화 시 추가

---

## 느낀 점/난이도/발견

### 발견
- **미리보기 버튼이 2곳**에 있었음:
  - TopBar: `window.open('/inv/${id}', '_blank')`
  - PreviewPanel 하단: 동일
  - 둘 다 404 페이지로 가고 있었음

- **편집기는 완성도 높은데 발행 플로우가 없었음**:
  - 자동 저장, 실시간 미리보기, 검증 표시 모두 있음
  - 근데 "완료" 버튼이 없어서 사용자가 뭘 해야 할지 모름

### 난이도
- **낮음**: 대부분 기존 코드 활용 가능
  - ClassicTemplate: 이미 렌더링 로직 완성
  - Sidebar: 검증 로직 존재
  - API: status 업데이트만 추가

- **고민 포인트**: UX 플로우 설계
  - 검증 실패 시 어떻게 안내할 것인가
  - 발행 후 편집 가능 여부
  - URL 보안

### 기술적 인사이트
- **Next.js 16 async params**:
  ```typescript
  export default async function InvitationPage({ params }: { params: Promise<{ id: string }> }) {
    const { id } = await params;
  }
  ```
  이거 잊지 말 것

- **상태 전환 설계**:
  ```
  DRAFT → (검증) → PUBLISHED
         ↑             ↓
         └──(비공개?)──┘
  ```

---

## 남은 것/미정

### 구현 대기
- [ ] `/app/inv/[id]/page.tsx` 작성
- [ ] TopBar에 발행 버튼 추가
- [ ] 필수 필드 검증 로직
- [ ] API status 업데이트 처리
- [ ] 토스트 컴포넌트 (또는 alert 임시 사용)

### 미정 사항
- [ ] 발행 취소 기능 필요 여부
- [ ] 발행 후 편집 제한 여부
- [ ] URL nanoid 적용 시기
- [ ] 발행 시 알림 발송 (이메일/카카오톡)

---

## 다음 액션

1. **사용자 확인**:
   - 발행 취소 필요한지
   - 필수 검증 항목 범위 확인
   - 발행 후 편집 가능 여부

2. **구현 시작**:
   - Task #3부터 시작 (공개 페이지)
   - Task #4 (발행 기능)
   - 테스트 시나리오 작성

3. **추후 개선**:
   - nanoid URL (보안)
   - 발행 이력 (버전 관리)
   - 발행 시 알림 (Phase 2)

---

## 서랍메모

### CLAUDE.md에 추가할 것
- 상태 전환 플로우 다이어그램
- 필수 검증 항목 정책
- URL 구조 결정 사항

### 코드 컨벤션
- 발행 관련 로직은 `/lib/publish.ts`에 분리 고려
- 검증 로직은 Zod 스키마 활용 (이미 있음)

### 참고할 코드
- Sidebar.tsx의 `getTabStatus()` → 검증 로직 재사용
- PreviewPanel.tsx의 `previewData` → 기본값 처리 참고

---

## 내 질문 평가 및 피드백

### 사용자 질문
> "아 음.. 이거 다 완성하고 발행하기? 같은거 만들어야될거같아. 그리고 새창에서 미리보기하는거 안되는데"

**평가**:
- ✅ 명확한 문제 지적 (새창 미리보기 404)
- ✅ 기능 요구사항 (발행하기)
- ⚠️ 구체적 요구사항 부족 (어떤 검증? 어떤 플로우?)

**내 대응**:
- ✅ 문제 파악 (페이지 없음, 발행 기능 없음)
- ✅ 구현 방안 제시 (2개 작업 분리)
- ✅ 추가 질문 (발행 취소, 필수 항목)
- ⏸️ 대답 대기 중

**개선점**:
- 더 구체적인 UX 플로우 제시했으면 좋았을 것
- 유사 서비스 벤치마킹 제시 (카카오/네이버 청첩장)

---

**상태**: 기획 완료, 사용자 피드백 대기 중
