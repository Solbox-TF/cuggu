# 2026-02-24 데일리 플랜

> **세션 시작 시:** `bd prime` 실행할 것

## 방향: 보안 수정 + 밀린 P0 버그 해소

2/24 보안 리뷰로 CRITICAL 2건 + HIGH 4건 + MED 6건 신규 등록.
기존 코드베이스 감사(2/20) P0 6건도 여전히 미수정.
**오늘은 "빠른 보안 수정 → 기존 P0 버그 소화"**에 집중.
결제/AI/인프라/디자인시스템은 전부 보류.

---

## 0단계: 빠른 보안 수정 (30분)

코드 1~10줄 수준 즉시 처리 가능한 보안 이슈. 몰아서 끝낸다.

| # | 작업 | Beads | 예상 |
|---|------|-------|------|
| 0-1 | **`/api/example` 삭제** — 인증 없는 scaffolding 라우트 프로덕션 노출 | `cuggu-xavw` P1 | 1분 |
| 0-2 | **Admin console.log PII 제거** — layout.tsx에서 이메일/유저 객체 로깅 | `cuggu-cno3` P2 | 5분 |
| 0-3 | **test-internal 인증 추가** — NODE_ENV 체크만으로 보호, 내부 IP 노출 | `cuggu-2ktn` P1 | 10분 |
| 0-4 | **LIKE 와일드카드 이스케이프** — admin 유저 검색에서 %/_ 미이스케이프 | `cuggu-bgbb` P1 | 10분 |

**0단계 목표: 보안 리뷰 HIGH 4건 중 3건 즉시 해소**

---

## 1단계: 기존 P0 버그 수정 (오전~오후, 핵심)

2/20 감사에서 발견 후 5일째 미수정. 더 미루면 안 됨.

| # | 작업 | Beads | 예상 |
|---|------|-------|------|
| 1-1 | **console.log 개인정보 노출** — 이름, 연락처, 주소 등 PII 로깅 전수 제거 | `cuggu-upic` P0 | 30분 |
| 1-2 | **에디터 fake 데이터 자동저장** — 로드 실패 시 초기값으로 덮어쓰기 → 기존 데이터 손상 | `cuggu-g9f5` P0 | 1시간 |
| 1-3 | **얕은 병합 중첩 객체 유실** — spread로 nested object 덮어씀 | `cuggu-1rt3` P0 | 30분 |
| 1-4 | **Zustand 스토어 타이머 누수** — 클린업 안 되는 setInterval/setTimeout | `cuggu-aktz` P0 | 30분 |
| 1-5 | **stream vs generate 크레딧 차감 순서 불일치** — 한쪽은 선차감, 한쪽은 후차감 | `cuggu-ej1t` P0 | 30분 |
| 1-6 | **Job 완료 TOCTOU 레이스 컨디션** — 동시 완료 시 이중 처리 가능 | `cuggu-ctcn` P0 | 1시간 |

**참고 파일:**
- `stores/useEditorStore.ts` — 1-2, 1-3, 1-4
- `lib/ai/credits.ts` — 1-5
- `app/api/ai/generate/stream/route.ts` — 1-5, 1-6
- `app/api/ai/jobs/[id]/route.ts` — 1-6

**1단계 목표: P0 6건 전부 close. 이후 `bd sync`.**

---

## 2단계: 보안 강화 (오후, 시간 되면)

0단계보다 설계 판단이 필요한 보안 이슈.

| # | 작업 | Beads | 예상 | 비고 |
|---|------|-------|------|------|
| 2-1 | **ENCRYPTION_KEY 수정** — 29→32바이트, 기존 PII 재암호화 | `cuggu-n7tq` P0 | 30분 | .env.local + 마이그레이션 스크립트 |
| 2-2 | **JWT maxAge 30일→7일 + 로테이션** | `cuggu-j7qf` P2 | 15분 | auth.ts 수정 |
| 2-3 | **middleware.ts 추가** — 글로벌 인증 레이어 | `cuggu-9yyw` P2 | 1시간 | 공개 라우트 패턴 정의 필요 |
| 2-4 | **pageSize 상한 검증** — 페이지네이션 DoS 방어 | `cuggu-l1v0` P2 | 15분 | |

---

## 보류 (다음 세션 이후)

| 작업 | Beads | 사유 |
|------|-------|------|
| 프로덕션 시크릿 전체 로테이션 | `cuggu-ro6k` P0 | 코드 아님. Vercel/Supabase/AWS 콘솔에서 별도 처리 |
| CSP unsafe-inline 제거 | `cuggu-hxhz` P1 | 카카오 SDK 의존성 조사 필요. 잘못 건드리면 카카오 공유 깨짐 |
| AI 테마 프롬프트 인젝션 방어 | `cuggu-c006` P2 | 현재 영향도 낮음 (테마 CSS 생성에 한정) |
| 취약 의존성 업데이트 | `cuggu-yo7t` P2 | pnpm update 후 빌드/테스트 검증 시간 필요 |
| 결제 체인 (PortOne 6건) | `cuggu-ae6`~`cuggu-03e` | P0/P1 해소 후 |
| UI/디자인시스템 이슈 30건+ | 각종 P1 | 기능 버그 먼저 |
| Sentry / 성능 / 인프라 | `cuggu-gval` 등 | 트래픽 생기면 |

---

## 금지 사항

- **새 기능 구현** — 오늘은 버그 수정 + 보안만
- **리팩터링 욕구** — P0 해결에만 집중, 주변 코드 정리 자제
- **결제/UI 작업** — P0 전부 close 후로 미룸
- **추가 감사/리뷰** — 오늘 보안 리뷰 끝냈음, 실행만

---

## 이전 세션 피드백 반영

| 이전 상황 | 오늘 대응 |
|-----------|-----------|
| 2/20 감사 P0 6건 발견 후 미수정 (5일째) | 1단계에서 전부 처리 |
| 보안 리뷰 신규 13건 등록 | 0단계에서 빠른 것 먼저, 나머지 2단계 |
| notepad "다음 할 일: cuggu-g9f5" | 1-2에 포함 |
| 2/20 리뷰 "P0 보류하고 P2 기능 먼저 한 우선순위 문제" 지적 | 오늘은 P0/보안만 |

---

## 목표

**0단계 + 1단계 확실히 끝내기** (보안 빠른 수정 4건 + P0 버그 6건 = 10건 close).
2단계까지 가면 좋은 날.
