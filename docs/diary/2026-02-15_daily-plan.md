# 2026-02-15 오늘 할 일

## 목표

**어제 못 한 크레딧/앨범/갤러리 안정화 + DB 마이그레이션 실행.**
어제는 전면 감사로 P0/P1 11건 해결했지만, 원래 플랜(크레딧 버그, 갤러리 플로우, 앨범 v2)은 하나도 못 건드림.
오늘은 **유저가 체감하는 품질 개선**에 집중. 인프라/보안은 어제 끝냈으니 제품 쪽으로.

---

## 0단계: DB 마이그레이션 실행 (시작 전 필수, 10분)

어제 코드 수정분(0010~0012)이 DB에 미반영.

| # | 작업 | 참조 |
|---|------|------|
| 0-1 | **마이그레이션 실행** — 0010(템플릿 enum), 0011(인덱스), 0012(CASCADE→SET NULL) | 어제 커밋 |
| 0-2 | **실행 후 검증** — 테이블 FK 확인, 인덱스 존재 확인 | |

---

## 1단계: 크레딧 버그 수정 (오전, 집중)

2/14 플랜에서 밀린 작업. 유저 크레딧이 날아가는 건 서비스 신뢰 문제.

| # | 작업 | Beads | 예상 |
|---|------|-------|------|
| 1-1 | **배치 Job 미사용 크레딧 자동 환불** — Job COMPLETED/PARTIAL 시 `creditsReserved - creditsUsed` 차액 환불 | `cuggu-9c0` | 30분 |
| 1-2 | **크레딧 실시간 UI 반영** — AI 생성 후 크레딧 수치가 화면에 즉시 반영 안 되는 문제 | `cuggu-c7n` | 30분 |
| 1-3 | **웰컴 보너스 트랜잭션 기록** — NextAuth 가입 콜백에서 BONUS 타입 INSERT | `cuggu-41x` | 15분 |

**참고 파일:**
- `lib/ai/credits.ts` — 크레딧 atomic 연산
- `app/api/ai/generate/stream/route.ts` — 배치 Job 스트리밍
- `hooks/useCredits.ts` — 프론트 크레딧 조회

---

## 2단계: 갤러리-앨범 플로우 정리 (오전~오후)

갤러리 탭에 AI 생성이 직접 박혀있어서 UX 혼란. 앨범에서 생성 → 갤러리로 가져오기 구조로 전환.

| # | 작업 | Beads | 예상 |
|---|------|-------|------|
| 2-1 | **갤러리-앨범 플로우 재설계** — 복사 vs 참조 정책 결정, import UI/API 설계 | `cuggu-r82` | 1시간 |
| 2-2 | **GalleryTab AI 섹션 제거 → CTA 카드 교체** — '앨범에서 불러오기' 버튼 | `cuggu-6h7` | 30분 |

**참고 파일:**
- `components/editor/tabs/GalleryTab.tsx` — 현재 갤러리 탭
- `app/api/ai/albums/[id]/apply/route.ts` — 앨범→갤러리 apply API
- `app/api/ai/generations/apply/route.ts` — 단건 apply API

---

## 3단계: AI 앨범 v2 안정화 (오후)

P0인데 4일째 보류. 설계 문서는 `docs/ai-album-v2-design.md`.

| # | 작업 | Beads | 예상 |
|---|------|-------|------|
| 3-1 | **앨범 v2 현재 상태 점검** — 기존 코드 동작 확인, 남은 버그/미구현 파악 | `cuggu-3ff` | 30분 |
| 3-2 | **발견된 이슈 처리** — 3-1 결과에 따라 | `cuggu-3ff` | 1~2시간 |

**참고 파일:**
- `app/dashboard/ai-photos/` — AI 앨범 페이지
- `docs/ai-album-v2-design.md` — 설계 문서

---

## 4단계: 시간 되면

| # | 작업 | Beads | 비고 |
|---|------|-------|------|
| 4-1 | 스마트스토어 셀러 등록 신청 | — | 심사 3~5일, 빨리 시작 |
| 4-2 | 스마트스토어 Commerce API 클라이언트 | `cuggu-97k` | 주문번호 검증용 |
| 4-3 | 스마트스토어 활성화 API + 페이지 | `cuggu-fa4` | 4-2 이후 |

결제 코드는 스마트스토어 방향으로 전환됨.
기존 PortOne 이슈(`cuggu-ae6`~`cuggu-03e`)는 보류/재검토 필요.

---

## 금지 사항

- **새 설계 문서 작성** — 코드 중심, 기존 문서 참고
- **추가 전면 감사** — 어제 끝냄. 오늘은 제품 품질에만 집중
- **P2/P3 이슈 선행 처리** — 1~3단계 끝날 때까지 보류

---

## 어제 피드백 반영

| 어제 상황 | 오늘 대응 |
|-----------|-----------|
| 원래 플랜 하나도 못 함 (전면 감사에 시간 씀) | 오늘은 밀린 플랜 1~3단계를 그대로 실행 |
| 결제 방향 스마트스토어로 전환 | PortOne 이슈 보류, 스마트스토어 이슈 우선 |
| P0/P1 보안·안정성 해결 완료 | 인프라 작업 종료, 제품 품질로 전환 |
| DB 마이그레이션 3개 미실행 | 0단계에서 첫 번째로 실행 |
