# AI 사진 생성 프로세스 전면 개편 설계서

> 팀 분석 (PM 1 + UX 2 + UI 개발자 2 + 백엔드 아키텍트 1 + 프로덕트 기획 1) 결과
> 기존 설계: `docs/ai-album-v2-design.md` (앨범-퍼스트 리디자인)
> 이 문서: 앨범 v2 위에 **생성 방식의 다양화 + 크레딧 정책 + UX 개선**을 추가

---

## 1. 현재 상태 & 문제점

### 1.1 현재 생성 플로우

```
앨범 이름 입력 → 앨범 생성 → 빈 대시보드 → "추가 촬영" 클릭
→ 사진 업로드 → 스타일 선택 → 생성 (SSE 스트리밍, 1크레딧=2장)
```

**문제 6가지:**

| # | 문제 | 영향 |
|---|------|------|
| 1 | 온보딩에서 첫 결과물까지 6단계 — 너무 길다 | 전환율 직결, 이탈 위험 |
| 2 | 매 생성마다 사진 재업로드 필요 | 묶음 생성 불가능, UX 마찰 |
| 3 | 생성 모드가 1개 (단건) — 묶음/배치 없음 | 대량 생성 수요 미충족 |
| 4 | 크레딧 비용 불투명 (사전 확인 없이 차감) | 구매 저항, CS 리스크 |
| 5 | 크레딧 부족 시 충전 동선 없음 (데드엔드) | 과금 전환율 0% |
| 6 | 자동 저장 사전 안내 없음 | "원치 않는 사진이 앨범을 채운다" 불만 |

### 1.2 현재 기술 스택 (변경 없음)

- **Frontend**: Next.js 16 (App Router), TypeScript, Tailwind CSS, Framer Motion
- **Backend**: Next.js API Routes, Drizzle ORM, PostgreSQL (Supabase)
- **AI**: Replicate (Flux Pro/Dev, PhotoMaker), OpenAI, Gemini
- **Storage**: AWS S3 + CloudFront
- **Auth**: NextAuth.js v5

### 1.3 현재 핵심 파일

| 영역 | 파일 | 비고 |
|------|------|------|
| DB 스키마 | `db/schema.ts` | aiGenerations, aiAlbums, users.aiCredits |
| 생성 API | `app/api/ai/generate/stream/route.ts` | SSE 스트리밍, 주력 |
| 프로바이더 | `lib/ai/providers/{replicate,openai,gemini}.ts` | 멀티 프로바이더 |
| 크레딧 | `lib/ai/credits.ts` | 확인/차감/환불 |
| 앨범 대시보드 | `app/dashboard/ai-photos/components/AlbumDashboard.tsx` | 900줄, 리팩터 대상 |
| 스트리밍 갤러리 | `components/ai/AIStreamingGallery.tsx` | 2x2 고정, 확장 필요 |

---

## 2. 목표

```
현재: "AI 사진 생성 도구" → 사진 1장씩 만들기
목표: "AI 웨딩 촬영 서비스" → 묶음/개별로 촬영하고 앨범 완성
```

**핵심 전환:**
- 사진 없음 → 참조 사진 등록 → 촬영 모드 선택 → 크레딧 확인 → 생성 → 자동 저장 → 큐레이션
- 기존 사진 있음 → "추가 촬영" → 모드 선택 → 크레딧 확인 → 생성 → 자동 저장

---

## 3. 생성 모드 설계

### 3.1 모드 구성: 2개 (3개에서 축소)

**원안 (사용자 제안):**
1. 스냅 촬영 (10/20장)
2. 한 장씩 원하는 스타일
3. 랜덤 스냅 (5~30장)

**팀 추천 — 2모드로 축소:**

| 모드 | 설명 | 크레딧 |
|------|------|--------|
| **묶음 촬영** | 스냅타입 선택 → 장수 선택 (5/10/20) → 스타일 자동 배분 | 장수 × 1 |
| **개별 촬영** | 스타일 직접 선택 (멀티셀렉트) → 선택 수만큼 생성 | 선택 수 × 1 |

**축소 근거 (PM + UX):**
- "스냅 촬영 10장"과 "랜덤 스냅 10장"의 유저 입장 차이가 불분명
- 묶음 촬영에서 장수만 선택하면 사실상 랜덤 스냅과 동일
- 3개 모드는 선택 과부하만 유발

### 3.2 묶음 촬영 세트 구성

#### 5장 세트 — "라이트 스냅"

| 슬롯 | 스타일 | 신랑 | 신부 | 소계 |
|------|--------|------|------|------|
| 1-2 | 스냅타입 내 인기 스타일 #1 | 1 | 1 | 2 |
| 3-4 | 스냅타입 내 인기 스타일 #2 | 1 | 1 | 2 |
| 5 | 스냅타입 내 랜덤 | 1 | 0 | 1 |
| | | | **합계** | **5장** |

#### 10장 세트 — "에센셜 스냅"

| 슬롯 | 스타일 | 신랑 | 신부 | 소계 |
|------|--------|------|------|------|
| 1-2 | 클래식 스튜디오 | 1 | 1 | 2 |
| 3-4 | 럭셔리 호텔 | 1 | 1 | 2 |
| 5-6 | 야외 가든 | 1 | 1 | 2 |
| 7-8 | 전통 한복 | 1 | 1 | 2 |
| 9-10 | 유저 선택 1종 | 1 | 1 | 2 |
| | | | **합계** | **10장** |

#### 20장 세트 — "프리미엄 스냅"

| 슬롯 | 스타일 | 신랑 | 신부 | 소계 |
|------|--------|------|------|------|
| 1-4 | 클래식 스튜디오 | 2 | 2 | 4 |
| 5-8 | 럭셔리 호텔 | 2 | 2 | 4 |
| 9-10 | 미니멀리즘 | 1 | 1 | 2 |
| 11-14 | 야외 가든 | 2 | 2 | 4 |
| 15-16 | 해변 일몰 | 1 | 1 | 2 |
| 17-18 | 전통 한복 | 1 | 1 | 2 |
| 19-20 | 유저 선택 1종 | 1 | 1 | 2 |
| | | | **합계** | **20장** |

### 3.3 개별 촬영 상세

- 스타일 카드 그리드 (SnapType 탭으로 필터)
- **멀티셀렉트** 지원 — 여러 스타일 선택 시 순차 생성
- 선택한 스타일 수 × 1크레딧
- 역할(신랑/신부) 선택 또는 "둘 다" 옵션

---

## 4. 유저 플로우

### 4.1 첫 방문 — 위저드(스텝) 방식

```
Step 1: 참조 사진 등록
┌──────────────────────────────┐
│  AI 웨딩 촬영을 시작해볼까요?  │
│                              │
│  ┌────────┐  ┌────────┐     │
│  │ 신랑👤 │  │ 신부👤 │     │
│  │ [업로드]│  │ [업로드]│     │
│  └────────┘  └────────┘     │
│                              │
│  * 정면 얼굴이 잘 보이는 사진  │
│  * 1명만 나온 사진            │
│                              │
│          [ 다음 → ]          │
└──────────────────────────────┘

Step 2: 촬영 모드 선택
┌──────────────────────────────┐
│  촬영 모드 선택               │
│                              │
│  ┌────────────────────────┐  │
│  │ 📸 묶음 촬영            │  │
│  │ 스냅타입 선택 후 자동 촬영 │  │
│  │ 5/10/20장 · 크레딧 동일  │  │
│  └────────────────────────┘  │
│                              │
│  ┌────────────────────────┐  │
│  │ 🎨 개별 촬영            │  │
│  │ 원하는 스타일 직접 선택   │  │
│  │ 스타일당 1장 · 1 크레딧   │  │
│  └────────────────────────┘  │
│                              │
│  잔여 크레딧: 5              │
└──────────────────────────────┘

Step 3: 스타일/장수 설정 (모드에 따라 다름)

[묶음 촬영 선택 시]
┌──────────────────────────────┐
│  스냅 타입 선택               │
│                              │
│  ┌────────┐┌────────┐┌─────┐│
│  │스튜디오 ││  야외  ││컨셉 ││
│  │ ✓선택  ││       ││     ││
│  └────────┘└────────┘└─────┘│
│                              │
│  촬영 장수                    │
│  [ 5장 ] [●10장] [ 20장 ]    │
│                              │
│          [ 다음 → ]          │
└──────────────────────────────┘

[개별 촬영 선택 시]
┌──────────────────────────────┐
│  촬영할 스타일 선택 (복수 가능) │
│                              │
│  [스튜디오] [야외] [컨셉] ← 탭│
│                              │
│  ┌─────────┐  ┌─────────┐   │
│  │ 클래식   │  │ 럭셔리   │   │
│  │ 스튜디오 │  │ 호텔    │   │
│  │ ✓       │  │         │   │
│  └─────────┘  └─────────┘   │
│  ┌─────────┐  ┌─────────┐   │
│  │ 미니멀   │  │ 흑백     │   │
│  │         │  │ ✓       │   │
│  └─────────┘  └─────────┘   │
│                              │
│  2개 선택 · 2 크레딧          │
│          [ 다음 → ]          │
└──────────────────────────────┘

Step 4: 크레딧 확인 (P0 — 필수)
┌──────────────────────────────┐
│  촬영 확인                    │
│                              │
│  모드: 묶음 촬영 · 스튜디오    │
│  장수: 10장                   │
│  비용: 10 크레딧              │
│                              │
│  ┌──────────────────────────┐│
│  │ 잔여 15 → 5 크레딧       ││
│  │ ████████████░░░░ 15/15   ││
│  └──────────────────────────┘│
│                              │
│  ℹ 생성된 사진은 앨범에       │
│    자동 저장됩니다             │
│  ℹ 실패 시 크레딧 자동 환불    │
│                              │
│  [← 이전]      [촬영 시작 →] │
└──────────────────────────────┘
```

### 4.2 추가 촬영 (기존 앨범 있을 때)

```
앨범 대시보드 → "추가 촬영" 클릭
→ Step 2로 바로 진입 (참조 사진 이미 등록됨)
→ 모드 선택 → 설정 → 크레딧 확인 → 생성
```

### 4.3 생성 중 화면

```
[단일 생성 (1-2장)]
┌──────────────────────────────┐
│  🔄 AI 촬영 중...             │
│  ██████░░░░ 1/2장 완료       │
│                              │
│  ┌─────────┐  ┌─────────┐   │
│  │  ✓ 완료 │  │ 🔄 생성중│   │
│  │  [img]  │  │  pulse  │   │
│  └─────────┘  └─────────┘   │
└──────────────────────────────┘

[묶음 생성 (10장+)]
┌──────────────────────────────┐
│ ⏳ AI 촬영 중   4/10장        │
│ ████████░░░░░░░░ 40%        │
│ 약 2분 30초 남음       [최소화]│
├──────────────────────────────┤
│ ┌────┐ ┌────┐ ┌────┐        │
│ │ ✓1 │ │ ✓2 │ │ ✓3 │        │
│ │img │ │img │ │img │        │
│ └────┘ └────┘ └────┘        │
│ ┌────┐ ┌────┐ ┌────┐        │
│ │🔄4 │ │⏸5  │ │⏸6  │        │
│ │생성 │ │대기 │ │대기 │        │
│ └────┘ └────┘ └────┘        │
│ ...                          │
└──────────────────────────────┘

[최소화 시 하단 플로팅 바]
┌──────────────────────────────┐
│ 🔄 AI 촬영 중 4/10장  [열기] │
└──────────────────────────────┘
```

### 4.4 결과 화면

```
┌──────────────────────────────┐
│  🎉 10장 촬영 완료!           │
│                              │
│  ┌────┐ ┌────┐ ┌────┐       │
│  │ 1  │ │ 2  │ │ 3  │       │
│  └────┘ └────┘ └────┘       │
│  ┌────┐ ┌────┐ ┌────┐       │
│  │ 4  │ │ 5  │ │ 6  │       │
│  └────┘ └────┘ └────┘       │
│  ... (스크롤)                │
│                              │
│  사용: 10 크레딧 · 잔여 5     │
│                              │
│  [앨범 큐레이션으로]  [추가 촬영]│
└──────────────────────────────┘
```

---

## 5. 크레딧 정책

### 5.1 단가

**MVP: 1장 = 1크레딧. 예외 없음.**

| 항목 | 크레딧 | 이유 |
|------|--------|------|
| 묶음 촬영 5장 | 5 | 장수 × 1 |
| 묶음 촬영 10장 | 10 | 장수 × 1 |
| 묶음 촬영 20장 | 20 | 장수 × 1 |
| 개별 촬영 1스타일 | 1 | 스타일 × 1 |
| 개별 촬영 3스타일 | 3 | 스타일 × 1 |

> 묶음 할인은 Phase 2에서 사용 패턴 데이터 기반으로 결정.

### 5.2 BATCH_SIZE 변경

**현재**: 1크레딧 = 2장 생성 (BATCH_SIZE=2)
**제안**: 1크레딧 = 1장 생성으로 변경

> ⚠️ 결정 필요: 이 변경은 기존 유저의 기대를 깨뜨릴 수 있음.
> 대안: BATCH_SIZE 유지하되 "1크레딧 = 2장" 명시.

### 5.3 크레딧 라이프사이클 (배치)

```
Step 1: Job 생성 — 크레딧 선차감 (RESERVE)
  users.aiCredits: 15 → 5  (10크레딧 예약)

Step 2~: 개별 이미지 생성 성공
  credit_tx: CONSUME × N

Step 완료: Job 완료
  성공 8장 / 실패 2장
  → 미사용 2크레딧 자동 환불 (REFUND)
  → users.aiCredits: 5 → 7
```

### 5.4 크레딧 패키지 (가격표)

| 패키지 | 크레딧 | 가격 (KRW) | 크레딧당 | 할인 |
|--------|--------|-----------|---------|------|
| 스타터 | 10 | ₩3,900 | ₩390 | 기준가 |
| 베이직 | 30 | ₩9,900 | ₩330 | 15% |
| 프리미엄 | 50 | ₩14,900 | ₩298 | 24% |
| 프로 | 100 | ₩24,900 | ₩249 | 36% |

**원가 분석** (PhotoMaker 기준):
- 장당 API 비용: ~₩13
- 스타터 10크레딧 매출 ₩3,900, 원가 ₩130 → **마진 97%**

### 5.5 무료 체험

| 시점 | 크레딧 |
|------|--------|
| 가입 시 | 2 크레딧 (현재 유지) |
| 첫 앨범 생성 시 | +3 크레딧 보너스 → 총 5장 체험 |

---

## 6. 백엔드 아키텍처

### 6.1 신규 테이블

#### `ai_reference_photos` — 참조 사진

```
id: varchar(128), PK
userId: FK → users.id, CASCADE
role: varchar(8)           // 'GROOM' | 'BRIDE'
originalUrl: varchar(500)  // S3 URL
faceDetected: boolean
isActive: boolean          // 현재 사용 중인 사진
createdAt: timestamp
INDEX: (userId, role)
```

> 한 번 업로드 후 모든 생성에서 재사용. 매번 재업로드 X.

#### `ai_generation_jobs` — 생성 작업

```
id: varchar(128), PK
userId: FK → users.id, CASCADE
albumId: FK → ai_albums.id, SET NULL
mode: varchar(16)          // 'SNAP' | 'SINGLE'
config: jsonb              // { snapType, styles[], modelId, groomRefId, brideRefId }
totalImages: integer
completedImages: integer   // default 0
failedImages: integer      // default 0
creditsReserved: integer   // 선차감 크레딧
creditsUsed: integer       // default 0, 실제 소모
status: enum               // PENDING | PROCESSING | COMPLETED | PARTIAL | FAILED | CANCELLED
createdAt: timestamp
completedAt: timestamp?
INDEX: (userId, status)
```

**상태 머신:**
```
PENDING → PROCESSING → COMPLETED (전부 성공)
                     → PARTIAL   (일부 실패)
                     → FAILED    (전부 실패)
PENDING/PROCESSING → CANCELLED  (유저 취소)
```

#### `ai_credit_transactions` — 크레딧 거래 이력

```
id: varchar(128), PK
userId: FK → users.id, CASCADE
type: enum                 // RESERVE | CONSUME | REFUND | PURCHASE | BONUS
amount: integer            // 항상 양수, type으로 방향 구분
balanceAfter: integer      // 트랜잭션 후 잔액 스냅샷
referenceType: varchar(32) // JOB | PAYMENT | ADMIN | SYSTEM
referenceId: varchar(128)
description: varchar(255)
createdAt: timestamp
INDEX: (userId, createdAt)
```

> `users.aiCredits`는 여전히 정합성 원천. 트랜잭션 테이블은 감사 로그.

#### 기존 테이블 수정: `ai_generations`

```
+ jobId: FK → ai_generation_jobs.id, SET NULL
```

기존 데이터: `jobId = NULL`로 보존. 하위 호환 문제 없음.

### 6.2 API 엔드포인트

#### 참조 사진

| Method | Endpoint | 설명 |
|--------|----------|------|
| POST | `/api/ai/reference-photos` | 업로드 + 얼굴 감지 |
| GET | `/api/ai/reference-photos` | 목록 조회 (role별) |
| DELETE | `/api/ai/reference-photos/[id]` | 삭제 |

#### 생성 작업 (Job)

| Method | Endpoint | 설명 |
|--------|----------|------|
| POST | `/api/ai/jobs` | Job 생성 + 크레딧 선차감 |
| GET | `/api/ai/jobs/[id]` | 진행 상태 조회 |

#### 기존 API 확장

```
POST /api/ai/generate/stream (기존 유지, 파라미터 추가)
  + jobId?: string              // Job에 귀속
  + referencePhotoId?: string   // 참조 사진 ID (image 대신)
  + image?: File                // 하위 호환: 직접 업로드도 가능

done 이벤트에 jobProgress 추가:
  { ..., jobProgress: { completed: 4, total: 10 } }
```

하위 호환 100% — jobId 없으면 기존처럼 독립 생성.

#### 크레딧

| Method | Endpoint | 설명 |
|--------|----------|------|
| GET | `/api/ai/credits` | 잔액 + 최근 거래 이력 |

### 6.3 배치 생성 아키텍처

```
클라이언트 오케스트레이션 (서버 큐 X)

1. Client → POST /api/ai/jobs (Job 생성, 크레딧 선차감)
2. Client → 태스크 리스트 수신
3. Client → for each task:
     POST /api/ai/generate/stream { jobId, style, role, referencePhotoId }
     (SSE 스트리밍으로 결과 수신)
     (요청 간 1-2초 딜레이 — Rate Limit 방어)
4. 전체 완료/부분 실패 → 미사용 크레딧 자동 환불
```

**왜 클라이언트 오케스트레이션인가:**
- 서버 큐(Inngest/Trigger.dev) 도입 불필요 — 현재 단계에서 오버엔지니어링
- Vercel 서버리스 타임아웃(300s) 문제 회피
- 기존 SSE 파이프라인 100% 재활용
- 단점: 클라이언트 이탈 시 나머지 미실행 → Job PARTIAL 처리

### 6.4 동시성 제어

- **크레딧 차감**: `WHERE ai_credits >= N` 원자적 UPDATE (기존 패턴)
- **동시 Job 제한**: 유저당 PROCESSING Job 1개로 제한
- **Rate Limit**: 기존 Upstash Redis 5회/10분 유지, 요청 간 딜레이 추가

---

## 7. 프론트엔드 아키텍처

### 7.1 라우트 구조 (변경 없음)

```
app/dashboard/ai-photos/
├── page.tsx                    ← 앨범 리스트 (기존 유지)
├── [albumId]/page.tsx          ← 앨범 상세 (기존, 리팩터링)
└── components/                 ← 컴포넌트 추가/수정
```

### 7.2 신규 컴포넌트

| 컴포넌트 | 역할 |
|---------|------|
| `GenerationWizard.tsx` | 4스텝 생성 플로우 관리 (AnimatePresence 슬라이드) |
| `ModeSelectStep.tsx` | 묶음/개별 모드 선택 카드 |
| `StyleConfigStep.tsx` | 모드별 스타일/장수 설정 |
| `CreditConfirmStep.tsx` | 크레딧 확인 + 생성 시작 (P0) |
| `BatchGenerationView.tsx` | 대량 생성 프로그레스 (스크롤형 그리드) |
| `GenerationFloatingBar.tsx` | 최소화 시 하단 플로팅 바 |
| `ResultReveal.tsx` | 결과 카드 리빌 애니메이션 |
| `CreditDisplay.tsx` | 잔여 + 소모 예정 크레딧 표시 |

### 7.3 리팩터 대상

| 컴포넌트 | 변경 |
|---------|------|
| `AlbumDashboard.tsx` (900줄) | 생성 로직 분리 → 500줄 이하로 |
| `AlbumOnboarding.tsx` | 참조 사진 업로드 스텝 추가 |
| `AIPhotoUploader.tsx` | 얼굴 가이드 힌트 추가 |
| `StyleSelector.tsx` | 멀티셀렉트 지원 + 썸네일 |
| `AIStreamingGallery.tsx` | BatchGenerationView로 확장 |

### 7.4 SSE 중복 제거

```typescript
// hooks/useAIGeneration.ts — 신규 커스텀 훅
function useAIGeneration(albumId: string, model: string) {
  return {
    generate,        // SSE 스트리밍 생성 실행
    streamingUrls,   // 실시간 이미지 URL 배열
    statusMessage,   // "생성 중...", "완료" 등
    result,          // 최종 결과
    error,           // 에러
    isGenerating,    // 로딩 상태
    progress,        // { completed, total }
  };
}
```

> AlbumDashboard.handleGenerate와 AIPhotoGenerator.handleGenerate의 SSE 파싱 코드가 거의 동일.
> 이 훅으로 통합하면 모든 Flow 컴포넌트에서 재사용 가능.

### 7.5 상태 관리

**Zustand 전역 스토어: 도입하지 않음** (과잉)

예외: `generationProgressStore` 1개만 — 생성 진행 상태는 페이지 이동해도 하단 플로팅 바 유지 필요.

```typescript
// stores/generation-progress.ts
interface GenerationProgressStore {
  isGenerating: boolean;
  total: number;
  completed: number;
  results: { url: string; style: string; role: string }[];
  error: string | null;
}
```

나머지 상태는 컴포넌트 로컬 useState + props drilling (트리 깊이 3-4레벨이라 합리적).

### 7.6 모바일 패턴

| 패턴 | 적용 위치 |
|------|----------|
| 스텝 슬라이드 (좌→우) | GenerationWizard |
| 스티키 프로그레스 바 | BatchGenerationView 상단 |
| 하단 플로팅 바 | 생성 중 최소화 |
| 풀스크린 이미지 뷰어 | 결과 이미지 탭 시 |
| 하단 고정 CTA | "촬영 시작" 버튼 |

### 7.7 Framer Motion 애니메이션

| 위치 | 효과 |
|------|------|
| 스텝 전환 | 방향 인지 슬라이드 (좌→우, 우→좌) |
| 이미지 생성 완료 | `scale: [0.8→1]` + `blur: [10→0]` spring |
| 크레딧 변경 | 숫자 카운트 애니메이션 |
| 대기 슬롯 | pulse 애니메이션 (opacity 0.4↔1) |
| 결과 리빌 | 카드별 150ms 딜레이 순차 등장 |

---

## 8. UX 개선 체크리스트 (우선순위별)

### P0 — 반드시 MVP에 포함

| # | 항목 | 설명 |
|---|------|------|
| 1 | 크레딧 확인 단계 | 묶음 생성 전 비용/잔여 크레딧/안내 사항 표시 |
| 2 | 크레딧 부족 → 충전 CTA | "크레딧 충전하기 →" 링크 (결제 페이지 연결) |
| 3 | 실패 시 환불 알림 | "크레딧 1개가 환불되었습니다" 토스트 |
| 4 | 자동 저장 사전 안내 | "생성된 사진은 앨범에 자동 저장됩니다" 텍스트 |

### P1 — MVP에 가능하면 포함

| # | 항목 | 설명 |
|---|------|------|
| 5 | 참조 사진 재사용 | 한 번 업로드 후 매 생성마다 재사용 |
| 6 | 빈 대시보드 empty state | "첫 AI 웨딩 사진을 만들어보세요" + CTA |
| 7 | 잔여 크레딧 생성 버튼 근처 표시 | `잔여: 8 | 이번: -10` 형태 |
| 8 | 생성 버튼 동적 라벨 | 사진 0장: "첫 사진 만들기" / 1장+: "추가 촬영" |

### P2 — Phase 2

| # | 항목 | 설명 |
|---|------|------|
| 9 | 백그라운드 생성 안내 | "페이지를 떠나도 생성 완료 시 저장됩니다" |
| 10 | 크레딧 거래 이력 UI | 충전/소모/환불 내역 조회 |
| 11 | 마음에 안 드는 사진 재생성 | "이 스타일로 다시 촬영" (1크레딧) |
| 12 | 앨범에서 제외 옵션 | 자동 저장된 사진 숨기기 |

---

## 9. 구현 순서

### Phase 1: 인프라 (백엔드)

| # | 작업 | 파일 |
|---|------|------|
| 1 | `ai_reference_photos` 테이블 + 마이그레이션 | `db/schema.ts` |
| 2 | `ai_generation_jobs` 테이블 + 마이그레이션 | `db/schema.ts` |
| 3 | `ai_credit_transactions` 테이블 + 마이그레이션 | `db/schema.ts` |
| 4 | `aiGenerations` + `jobId` FK 추가 | `db/schema.ts` |
| 5 | 참조 사진 API (CRUD + 얼굴 감지) | `app/api/ai/reference-photos/` |
| 6 | Job API (생성 + 크레딧 선차감) | `app/api/ai/jobs/` |
| 7 | 크레딧 API 확장 (거래 이력) | `app/api/ai/credits/` |
| 8 | 기존 stream API에 jobId/referencePhotoId 추가 | `app/api/ai/generate/stream/` |

### Phase 2: 프론트엔드 코어

| # | 작업 | 파일 |
|---|------|------|
| 9 | `useAIGeneration` 훅 추출 | `hooks/useAIGeneration.ts` |
| 10 | `GenerationWizard` + 4스텝 | `components/` |
| 11 | `ModeSelectStep` | `components/` |
| 12 | `StyleConfigStep` (멀티셀렉트) | `components/` |
| 13 | `CreditConfirmStep` | `components/` |
| 14 | `CreditDisplay` | `components/` |

### Phase 3: 생성 경험

| # | 작업 | 파일 |
|---|------|------|
| 15 | `BatchGenerationView` (대량 생성 프로그레스) | `components/` |
| 16 | `GenerationFloatingBar` (최소화) | `components/` |
| 17 | `ResultReveal` (결과 애니메이션) | `components/` |
| 18 | `AlbumDashboard` 리팩터 (생성 로직 분리) | 기존 파일 수정 |

### Phase 4: 폴리시

| # | 작업 | 파일 |
|---|------|------|
| 19 | Framer Motion 애니메이션 적용 | 각 컴포넌트 |
| 20 | 모바일 최적화 (스티키, 플로팅, 바텀시트) | 각 컴포넌트 |
| 21 | 에러 상태 처리 (실패 환불, Rate Limit 등) | 각 컴포넌트 |

---

## 10. 스코프 경계 (Out of Scope)

| 기능 | 시기 | 이유 |
|------|------|------|
| 마법사 모드 (AI 자동 추천 촬영) | Phase 2+ | 사용자 "별도 계획" 명시 |
| 배치 동시 생성 (병렬) | X | Rate Limit, 부분 실패, Vercel 제약 |
| 묶음 할인 가격 정책 | Phase 2 | 데이터 기반 결정 필요 |
| 커스텀 프롬프트 입력 | Phase 2+ | 프롬프트 품질 관리 불가 |
| 커플 합성 (두 사람 한 장) | Phase 3+ | AI 모델 한계, 별도 파이프라인 필요 |
| 카카오톡 앨범 공유 | Phase 3 | |
| 백그라운드 서버 생성 (큐) | 필요 시 | Inngest/Trigger.dev 도입 검토 |
| 이미지 크롭/편집 | X | 서버 얼굴 감지로 충분 |

---

## 11. 미결 사항 (결정 필요)

| # | 질문 | 선택지 | 추천 |
|---|------|--------|------|
| 1 | 모드 2개(묶음/개별)로 갈 건지? | A: 2개 / B: 3개 유지 | A |
| 2 | 묶음 장수 옵션 | A: 5/10/20 / B: 10/20만 | A |
| 3 | 1장 = 1크레딧 단순 정책 | A: 1:1 / B: 기존 1:2 유지 | 결정 필요 |
| 4 | 마법사 모드 Phase 2 연기 | A: 연기 / B: MVP 포함 | A |
| 5 | BATCH_SIZE 변경 | A: 1장/크레딧 / B: 2장/크레딧 유지 | 결정 필요 |
| 6 | 무료 크레딧 증가 (2→5) | A: 증가 / B: 현행 유지 | A |

---

## 12. 경쟁사 벤치마크

| 서비스 | 장당 가격 | 특징 | 우리 차별점 |
|--------|----------|------|-----------|
| SNOW AI | ₩413~825 | MZ 브랜드, 범용 | 웨딩 특화, 더 저렴 |
| EPIK AI | ~₩688 | 졸업사진 특화 | 커플 지원, 앨범 큐레이션 |
| Photo AI | ~₩6,825 | 웨딩 특화 | 한국 로컬 (한복), 청첩장 연계 |
| Remini | ₩14,000/월 | 보정 중심 | 생성 + 큐레이션 + 적용 원스톱 |

**핵심 차별화:**
1. 청첩장 원스톱 (생성 → 큐레이션 → 적용)
2. 한복/한국 스타일 특화
3. 앨범 큐레이션 (촬영 → 셀렉 → 앨범)
4. 경쟁사 대비 40-60% 저렴

---

## 13. KPI

| 지표 | 목표 | 측정 |
|------|------|------|
| 첫 생성 전환율 | 가입자의 40%+ | 가입 → 첫 크레딧 사용 |
| 유료 전환율 | 첫 생성 유저의 15%+ | 무료 소진 → 결제 |
| 세트 선택 비율 | 유료의 60%+ | 개별 vs 묶음 비율 |
| 청첩장 적용률 | 생성 유저의 50%+ | 앨범 → 청첩장 적용 |
| 평균 생성 수 | 유저당 12장+ | 총 생성 / 활성 유저 |
